// Load in modules
var system = require('system'),
    fs = require('fs'),
    webpage = require('webpage');

// Grab the arguments
var args = system.args,
    filepath = args[1],
    encodedArg = fs.read(filepath);

// If there is no image, throw an error
if (!encodedArg) {
  throw new Error('No argument was specified.');
}

// Load the compose webpage
var page = webpage.create();
page.open(phantom.libraryPath + '/compose.html?' + encodedArg, function (status) {
  // Pluck out the data png
  var dataUrl = page.evaluate(function () {
    return window.retStr.length + '';
  });

  // Remove the data/png
  var retStr = dataUrl.replace('data:image/png;base64,', '');
  console.log('wat' + dataUrl);
  // console.log(',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');

  // Leave the program
  phantom.exit();
});
